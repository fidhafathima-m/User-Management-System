<% include('../layouts/header.ejs') %>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="./register_styles.css">

<div class="body">
  <div class="veen">
    <div class="login-btn splits">
      <p>Already a user?</p>
      <a href="login" class="btn btn-dark loginn">Login</a>
    </div>
    <div class="wrapper">
      <form id="registerForm" tabindex="502" method="post" enctype="multipart/form-data" action="/register">
        <h3>Register</h3>
        <% if (typeof message !== 'undefined') { %>
          <h5 class="text-center text-success">
            <%= message %>
          </h5>
        <% } %>
        <!-- Full Name -->
        <div class="name">
          <input type="text" id="name" name="name" required>
          <label>Full Name</label>
        </div>
        <!-- Email -->
        <div class="mail">
          <input type="email" id="email" name="email" required>
          <label>Mail</label>
        </div>
        <!-- Phone Number (Validated) -->
        <div class="uid">
          <input type="text" id="phone" name="phone" required>
          <label>Phone Number</label>
        </div>
        <!-- Image Upload -->
        <div class="file">
          <input type="file" name="image" required>
          <label></label>
        </div>
        <!-- Password (Validated) -->
        <div class="passwd">
          <input type="password" id="password" name="password" required>
          <label>Password</label>
          <small id="passwordHelp" class="form-text text-muted">Password must be at least 8 characters long and contain both letters and numbers.</small>
        </div>
        <!-- Submit Button -->
        <div class="submit">
          <button type="submit" class="dark">Register</button>
        </div>
      </form>
    </div>
  </div>  
</div>

<style type="text/css">
  .site-link {
    padding: 5px 15px;
    position: fixed;
    z-index: 99999;
    background: #fff;
    box-shadow: 0 0 4px rgba(0, 0, 0, .14), 0 4px 8px rgba(0, 0, 0, .28);
    right: 30px;
    bottom: 30px;
    border-radius: 10px;
  }
  .site-link img {
    width: 30px;
    height: 30px;
  }
</style>

<script>
  // Function to validate password strength
  function validatePassword(password) {
    // Regular expression to check for at least 8 characters, a letter, and a number
    const passwordPattern = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;
    return passwordPattern.test(password);
  }

  // Validate the form on submit
  document.getElementById('registerForm').addEventListener('submit', function(event) {
    let isValid = true;

    // Clear previous error messages
    const errors = document.querySelectorAll('.error');
    errors.forEach(function(error) {
      error.remove();
    });

    const phone = document.getElementById('phone').value;

// Validate phone number: should be non-empty and 10 digits long
if (!phone) {
  isValid = false;
  const phoneField = document.getElementById('phone');
  const error = document.createElement('span');
  error.className = 'error text-danger';
  error.innerText = 'Phone number is required';
  phoneField.after(error);
} else if (phone.length !== 10) {
  isValid = false;
  const phoneField = document.getElementById('phone');
  const error = document.createElement('span');
  error.className = 'error text-danger';
  error.innerText = 'Phone number must be exactly 10 digits';
  phoneField.after(error);
}


    // Validate Password: should be at least 8 characters, contain letters and numbers
    const password = document.getElementById('password').value;
    if (!validatePassword(password)) {
      isValid = false;
      const passwordField = document.getElementById('password');
      const error = document.createElement('span');
      error.className = 'error text-danger';
      error.innerText = 'Password must be at least 8 characters long and contain both letters and numbers';
      passwordField.after(error);
    }

    // If form is not valid, prevent submission
    if (!isValid) {
      event.preventDefault();
    }
  });
</script>

<% include('../layouts/footer.ejs') %>
